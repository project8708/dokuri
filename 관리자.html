<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>관리자 페이지</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .admin-orders {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            background: #f4f4f4;
        }
        .order-item {
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>

<div class="admin-orders" id="admin-orders"></div>

<!-- Add Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>

<script>
  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCI2U6rdm1dVqHa4KTBO7ebiO49cnnM7W4",
    authDomain: "acoustic-arch-320110.firebaseapp.com",
    projectId: "acoustic-arch-320110",
    storageBucket: "acoustic-arch-320110.appspot.com",
    messagingSenderId: "975479821242",
    appId: "1:975479821242:web:a6b4d128893cdec1100383"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
</script>

<script>
    let previousOrderCount = 0;

    async function loadOrders() {
        const adminOrders = document.getElementById('admin-orders');
        try {
            const ordersRef = database.ref('orders');
            const snapshot = await ordersRef.once('value');
            const tableOrders = snapshot.val() || {};
            const currentOrderCount = Object.keys(tableOrders).length;

            if (currentOrderCount > previousOrderCount) {
                if ("vibrate" in navigator) {
                    navigator.vibrate(200);
                }

                const audio = new Audio('https://www.soundjay.com/button/beep-07.wav');
                audio.play();

                previousOrderCount = currentOrderCount;
            }

            if (Object.keys(tableOrders).length === 0) {
                adminOrders.innerHTML = '<p>주문 내역이 없습니다.</p>';
                return;
            }

            adminOrders.innerHTML = Object.keys(tableOrders).map(table => `
                <div class="order-item">
                    <h3>${table}</h3>
                    ${Object.values(tableOrders[table]).map(order => `
                        <div>
                            <p><strong>주문 시간:</strong> ${order.timestamp}</p>
                            ${order.items.map(item => `
                                <div>
                                    ${item.item} - ${item.price}원 x ${item.quantity}
                                </div>
                            `).join('')}
                            <p><strong>총 금액:</strong> ${order.total}원</p>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        } catch (error) {
            adminOrders.innerHTML = '<p>주문을 불러오는 중 오류가 발생했습니다.</p>';
            console.error('Error fetching orders:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', loadOrders);

    setInterval(loadOrders, 5000);
</script>

</body>
</html>

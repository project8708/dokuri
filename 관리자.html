<!DOCTYPE html>
<html lang="ko">
<head>\
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BGTD7LKT1C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BGTD7LKT1C');
</script>
    <meta charset="UTF-8">
    <title>관리자 페이지</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .admin-orders {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            background: #f4f4f4;
        }
        .order-item {
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>

<div class="admin-orders" id="admin-orders"></div>

<!-- Add Firebase SDK -->
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-analytics.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCI2U6rdm1dVqHa4KTBO7ebiO49cnnM7W4",
    authDomain: "acoustic-arch-320110.firebaseapp.com",
    databaseURL: "https://acoustic-arch-320110-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "acoustic-arch-320110",
    storageBucket: "acoustic-arch-320110.appspot.com",
    messagingSenderId: "975479821242",
    appId: "1:975479821242:web:a6b4d128893cdec1100383",
    measurementId: "G-BGTD7LKT1C"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const analytics = getAnalytics(app);

  let previousOrderCount = 0;
  const adminOrders = document.getElementById('admin-orders');

  function renderOrders(orders) {
      adminOrders.innerHTML = Object.keys(orders).map(table => `
          <div class="order-item">
              <h3>${table}</h3>
              ${Object.values(orders[table]).map(order => `
                  <div>
                      <p><strong>주문 시간:</strong> ${order.timestamp}</p>
                      ${order.items.map(item => `
                          <div>
                              ${item.item} - ${item.price}원 x ${item.quantity}
                          </div>
                      `).join('')}
                      <p><strong>총 금액:</strong> ${order.total}원</p>
                  </div>
              `).join('')}
          </div>
      `).join('');
  }

  function notifyUser() {
      if ("vibrate" in navigator) {
          navigator.vibrate(200);
      }

      const audio = new Audio('https://www.soundjay.com/button/beep-07.wav');
      audio.play();
  }

  function handleError(error) {
      adminOrders.innerHTML = '<p>주문을 불러오는 중 오류가 발생했습니다.</p>';
      console.error('Error fetching orders:', error);
  }

  async function loadOrders() {
      try {
          const ordersRef = ref(database, 'orders');
          onValue(ordersRef, snapshot => {
              const tableOrders = snapshot.val() || {};
              const currentOrderCount = Object.keys(tableOrders).length;

              if (currentOrderCount > previousOrderCount) {
                  notifyUser();
                  previousOrderCount = currentOrderCount;
              }

              if (currentOrderCount === 0) {
                  adminOrders.innerHTML = '<p>주문 내역이 없습니다.</p>';
              } else {
                  renderOrders(tableOrders);
              }
          }, handleError);
      } catch (error) {
          handleError(error);
      }
  }

  document.addEventListener('DOMContentLoaded', loadOrders);
</script>

</body>
</html>

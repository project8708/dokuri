<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>관리자 페이지</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .admin-orders {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            background: #f4f4f4;
        }
        .order-item {
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>

<div class="admin-orders" id="admin-orders"></div>

<script>
    let previousOrderCount = 0;

    async function loadOrders() {
        const adminOrders = document.getElementById('admin-orders');
        try {
            const response = await fetch('http://localhost:3000/api/orders'); // 서버의 주문 데이터를 가져오는 API 엔드포인트
            const tableOrders = await response.json();
            const currentOrderCount = Object.keys(tableOrders).length;

            if (currentOrderCount > previousOrderCount) {
                // 진동 알림
                if ("vibrate" in navigator) {
                    navigator.vibrate(200);
                }

                // 소리 알림
                const audio = new Audio('https://www.soundjay.com/button/beep-07.wav');
                audio.play();

                previousOrderCount = currentOrderCount;
            }

            if (Object.keys(tableOrders).length === 0) {
                adminOrders.innerHTML = '<p>주문 내역이 없습니다.</p>';
                return;
            }

            adminOrders.innerHTML = Object.keys(tableOrders).map(table => `
                <div class="order-item">
                    <h3>${table}</h3>
                    ${tableOrders[table].map(order => `
                        <div>
                            <p><strong>주문 시간:</strong> ${order.timestamp}</p>
                            ${order.items.map(item => `
                                <div>
                                    ${item.item} - ${item.price}원 x ${item.quantity}
                                </div>
                            `).join('')}
                            <p><strong>총 금액:</strong> ${order.total}원</p>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        } catch (error) {
            adminOrders.innerHTML = '<p>주문을 불러오는 중 오류가 발생했습니다.</p>';
            console.error('Error fetching orders:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', loadOrders);

    // 5초마다 주문을 확인합니다.
    setInterval(loadOrders, 5000);
</script>

</body>
</html>

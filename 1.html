<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>1ë²ˆ í…Œì´ë¸” ë©”ë‰´íŒ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .menu-category {
            margin-bottom: 20px;
        }
        .menu-category h2 {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
        }
        .menu-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
        .cart-icon {
            position: fixed;
            top: 10px;
            right: 50px;
            background: #333;
            color: #fff;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
        }
        .notification {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .cart-modal, .option-modal, .set-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-height: 80vh;
            overflow-y: auto;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
        }
        .set-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .table-number {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #333;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<div class="table-number">1ë²ˆ í…Œì´ë¸”</div>
<div class="cart-icon" onclick="toggleCart()">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ (<span id="cart-count">0</span>)</div>
<div class="notification" id="notification"></div>

<div class="modal-overlay" id="modal-overlay" onclick="closeModals()"></div>

<div class="cart-modal" id="cart-modal">
    <h2>ì¥ë°”êµ¬ë‹ˆ</h2>
    <div id="cart-items"></div>
    <div>
        <strong>ì´ ê¸ˆì•¡: <span id="total-price">0</span>ì›</strong>
    </div>
    <button onclick="closeCart()">ë‹«ê¸°</button>
    <button onclick="orderItems()">ì£¼ë¬¸í•˜ê¸°</button>
</div>

<div class="option-modal" id="option-modal">
    <h2>ì˜µì…˜ ì„ íƒ</h2>
    <div id="option-items"></div>
    <button onclick="selectOption()">ì„ íƒ</button>
    <button onclick="closeModals()">ë‹«ê¸°</button>
</div>

<div class="set-modal" id="set-modal">
    <h2>ì„¸íŠ¸ë©”ë‰´ ì„ íƒ</h2>
    <div id="set-items"></div>
    <div id="selected-set-items"></div>
    <button onclick="selectSet()">ì„ íƒ</button>
    <button onclick="closeModals()">ë‹«ê¸°</button>
</div>

<div class="menu-category">
    <h2>ì„¸íŠ¸ë©”ë‰´</h2>
    <div class="menu-item">ì„¸íŠ¸ë©”ë‰´ 1 ê¼¬ì¹˜ ì„ íƒ 5ì¢… 20,000ì› <button onclick="showSetOptions('ì„¸íŠ¸ë©”ë‰´ 1 ê¼¬ì¹˜ ì„ íƒ 5ì¢…', 20000, 5)">ì¶”ê°€</button></div>
    <div class="menu-item">ì„¸íŠ¸ë©”ë‰´ 2 ê¼¬ì¹˜ ì„ íƒ 10ì¢… 37,000ì› <button onclick="showSetOptions('ì„¸íŠ¸ë©”ë‰´ 2 ê¼¬ì¹˜ ì„ íƒ 10ì¢…', 37000, 10)">ì¶”ê°€</button></div>
</div>

<!-- Other menu categories go here -->

<!-- Add Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>

<script>
  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCI2U6rdm1dVqHa4KTBO7ebiO49cnnM7W4",
    authDomain: "acoustic-arch-320110.firebaseapp.com",
    projectId: "acoustic-arch-320110",
    storageBucket: "acoustic-arch-320110.appspot.com",
    messagingSenderId: "975479821242",
    appId: "1:975479821242:web:a6b4d128893cdec1100383"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
</script>

<script>
    let cart = [];
    let cartCount = 0;
    let totalPrice = 0;
    let currentItem = {};
    let currentOptions = {};
    let currentSetItems = {};
    let setItemCount = 0;
    let maxSetItems = 0;

    function addToCart(item, price, options = []) {
        const cartItem = cart.find(i => i.item === item && JSON.stringify(i.options) === JSON.stringify(options));
        if (cartItem) {
            cartItem.quantity++;
        } else {
            cart.push({ item, price, quantity: 1, options });
        }
        updateCart();
        showNotification(`${item}ì´(ê°€) ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    function updateCart() {
        cartCount = cart.reduce((count, item) => count + item.quantity, 0);
        totalPrice = cart.reduce((total, item) => total + item.price * item.quantity, 0);
        document.getElementById('cart-count').innerText = cartCount;
        document.getElementById('total-price').innerText = totalPrice;
        const cartItems = document.getElementById('cart-items');
        cartItems.innerHTML = '';
        cart.forEach(item => {
            const cartItemDiv = document.createElement('div');
            cartItemDiv.className = 'cart-item';
            cartItemDiv.innerHTML = `
                ${item.item} ${item.options.length > 0 ? `(${item.options.join(', ')})` : ''} - ${item.price}ì› x ${item.quantity}
                <button onclick="changeQuantity('${item.item}', 1, '${JSON.stringify(item.options)}')">+</button>
                <button onclick="changeQuantity('${item.item}', -1, '${JSON.stringify(item.options)}')">-</button>
            `;
            cartItems.appendChild(cartItemDiv);
        });
    }

    function changeQuantity(item, delta, options) {
        const cartItem = cart.find(i => i.item === item && JSON.stringify(i.options) === options);
        if (cartItem) {
            cartItem.quantity += delta;
            if (cartItem.quantity <= 0) {
                cart = cart.filter(i => !(i.item === item && JSON.stringify(i.options) === options));
            }
            updateCart();
        }
    }

    function showNotification(message) {
        const notification = document.getElementById('notification');
        notification.innerText = message;
        notification.style.display = 'block';
        setTimeout(() => {
            notification.style.display = 'none';
        }, 2000);
    }

    function toggleCart() {
        const cartModal = document.getElementById('cart-modal');
        const modalOverlay = document.getElementById('modal-overlay');
        cartModal.style.display = cartModal.style.display === 'block' ? 'none' : 'block';
        modalOverlay.style.display = modalOverlay.style.display === 'block' ? 'none' : 'block';
    }

    function closeCart() {
        document.getElementById('cart-modal').style.display = 'none';
        document.getElementById('modal-overlay').style.display = 'none';
    }

    function closeModals() {
        document.getElementById('cart-modal').style.display = 'none';
        document.getElementById('option-modal').style.display = 'none';
        document.getElementById('set-modal').style.display = 'none';
        document.getElementById('modal-overlay').style.display = 'none';
    }

    function showOptions(item, basePrice, options) {
        currentItem = { item, basePrice };
        currentOptions = options.reduce((obj, option) => {
            obj[option] = basePrice;
            return obj;
        }, {});
        const optionModal = document.getElementById('option-modal');
        const optionItems = document.getElementById('option-items');
        optionItems.innerHTML = options.map(option => `
            <div>
                <label>
                    <input type="radio" name="option" value="${option}"> ${option}
                </label>
            </div>
        `).join('');
        optionModal.style.display = 'block';
        document.getElementById('modal-overlay').style.display = 'block';
    }

    function showOptionsWithPrices(item, optionsWithPrices) {
        currentItem = { item };
        currentOptions = optionsWithPrices;
        const optionModal = document.getElementById('option-modal');
        const optionItems = document.getElementById('option-items');
        optionItems.innerHTML = Object.keys(optionsWithPrices).map(option => `
            <div>
                <label>
                    <input type="radio" name="option" value="${option}"> ${option} - ${optionsWithPrices[option]}ì›
                </label>
            </div>
        `).join('');
        optionModal.style.display = 'block';
        document.getElementById('modal-overlay').style.display = 'block';
    }

    function showSetOptions(item, price, maxItems) {
        currentItem = { item, price };
        maxSetItems = maxItems;
        currentSetItems = getSkewers().reduce((acc, skewer) => {
            acc[skewer] = 0;
            return acc;
        }, {});
        setItemCount = 0;
        const setModal = document.getElementById('set-modal');
        const setItems = document.getElementById('set-items');
        const selectedSetItems = document.getElementById('selected-set-items');
        setItems.innerHTML = `
            <p>ê¼¬ì¹˜êµ¬ì´ ì¤‘ì—ì„œ ${maxItems}ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
            ${getSkewers().map(skewer => `
                <div class="set-item">
                    ${skewer} - <span id="set-item-count-${skewer}">0</span>
                    <button onclick="changeSetItemCount('${skewer}', 1)">+</button>
                    <button onclick="changeSetItemCount('${skewer}', -1)">-</button>
                </div>
            `).join('')}
        `;
        selectedSetItems.innerHTML = '<strong>ì„ íƒëœ ê¼¬ì¹˜:</strong> 0ê°œ';
        setModal.style.display = 'block';
        document.getElementById('modal-overlay').style.display = 'block';
    }

    function changeSetItemCount(item, delta) {
        if (item === 'ì¸ ì¿ ë„¤' && currentSetItems[item] >= 1 && delta > 0) {
            alert('ì¸ ì¿ ë„¤ëŠ” 1ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
        }
        const newCount = currentSetItems[item] + delta;
        if (newCount < 0) return;
        if (setItemCount + delta > maxSetItems) {
            alert(`ìµœëŒ€ ${maxSetItems}ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
            return;
        }
        currentSetItems[item] = newCount;
        setItemCount += delta;
        document.getElementById(`set-item-count-${item}`).innerText = newCount;
        document.getElementById('selected-set-items').innerHTML = `<strong>ì„ íƒëœ ê¼¬ì¹˜:</strong> ${setItemCount}ê°œ`;
    }

    function selectOption() {
        const selectedOption = document.querySelector('input[name="option"]:checked').value;
        const price = currentOptions[selectedOption];
        addToCart(currentItem.item, price, [selectedOption]);
        closeModals();
    }

    function selectSet() {
        if (setItemCount === maxSetItems) {
            const selectedItems = [];
            for (let item in currentSetItems) {
                if (currentSetItems[item] > 0) {
                    selectedItems.push(`${item} x ${currentSetItems[item]}`);
                }
            }
            addToCart(currentItem.item, currentItem.price, selectedItems);
            closeModals();
        } else {
            alert(`ê¼¬ì¹˜êµ¬ì´ë¥¼ ${maxSetItems}ê°œ ì„ íƒí•´ì£¼ì„¸ìš”.`);
        }
    }

    function getSkewers() {
        return [
            'ì¸ ì¿ ë„¤', 'ë‹­ ë‚ ê°œ', 'ë‹­ ê°€ìŠ´ì‚´', 'ëª…ë€ë§ˆìš” ê°€ìŠ´ì‚´', 'ë¼ì§€ ì‚¼ê²¹',
            'ë‹­ ë‹¤ë¦¬ì‚´&íŒŒ', 'ë‹­ ë‹¤ë¦¬ì‚´', 'í•­ì •ì‚´', 'ë‹­ ëª©ì‚´', 'ê°ì&ìƒí¬ë¦¼',
            'ë§ˆëŠ˜', 'í‘œê³ ë²„ì„¯&ì™„ì', 'ì˜¥ìˆ˜ìˆ˜', 'ìƒˆì†¡ì´', 'ì€í–‰', 'ì–‘ì†¡ì´ ì‚¼ê²¹',
            'íŒ½ì´ë²„ì„¯ ì‚¼ê²¹', 'ë©”ì¶”ë¦¬ì•Œ ì‚¼ê²¹', 'ì•„ìŠ¤íŒŒë¼ ì‚¼ê²¹', 'ì´ˆìƒê°• ì‚¼ê²¹',
            'ë§ˆëŠ˜ ì‚¼ê²¹', 'í† ë§ˆí†  ì‚¼ê²¹', 'ë§‰ì°½', 'ë‹­ ê»ì§ˆ', 'ì—¼í†µ'
        ];
    }

    async function orderItems() {
        if (cart.length === 0) {
            alert("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
            return;
        }

        try {
            const newOrderRef = database.ref('orders').push();
            await newOrderRef.set({
                table: '1ë²ˆ í…Œì´ë¸”',
                items: cart,
                total: totalPrice,
                timestamp: new Date().toISOString()
            });
            
            alert("ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");

            if ("vibrate" in navigator) {
                navigator.vibrate(200);
            }

            const audio = new Audio('https://www.soundjay.com/button/beep-07.wav');
            audio.play();

            cart = [];
            updateCart();
            closeCart();
        } catch (error) {
            console.error('Error placing order:', error);
            alert('ì£¼ë¬¸ì„ ì™„ë£Œí•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
        }
    }
</script>

</body>
</html>
